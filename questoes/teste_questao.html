<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Redirecionamento de Questões</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .btn-responder {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
            font-size: 14px;
        }
        .btn-responder:hover {
            background-color: #0056b3;
        }
        .questao-item {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            background: #f9f9f9;
        }
        .log-area {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            margin-top: 20px;
            height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Teste - Redirecionamento de Questões</h1>
        <p>Esta página testa se a função JavaScript está funcionando corretamente.</p>
        
        <div class="questao-item">
            <h3>Questão 1 - Teste Individual</h3>
            <p>Esta questão deve abrir o quiz individual (sem filtro ativo)</p>
            <button type="button" class="btn-responder" onclick="redirecionarQuestao(1, 'nao-respondida')">
                Responder
            </button>
        </div>
        
        <div class="questao-item">
            <h3>Questão 2 - Teste Sequencial</h3>
            <p>Esta questão deve abrir o quiz sequencial (com filtro ativo)</p>
            <button type="button" class="btn-responder" onclick="setFiltroERedireccionar(2, 'nao-respondidas')">
                Responder (com filtro)
            </button>
        </div>
        
        <div class="questao-item">
            <h3>Controles de Teste</h3>
            <button type="button" class="btn-responder" onclick="limparFiltro()">Limpar Filtro</button>
            <button type="button" class="btn-responder" onclick="definirFiltro('nao-respondidas')">Definir Filtro: Não Respondidas</button>
            <button type="button" class="btn-responder" onclick="verificarFiltro()">Verificar Filtro Atual</button>
        </div>
        
        <div class="log-area" id="logArea">
            === LOG DE TESTE ===<br>
        </div>
    </div>

    <script>
        // Simular URL com parâmetro id=1
        history.replaceState(null, null, '?id=1');
        
        function log(message) {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            logArea.innerHTML += `[${timestamp}] ${message}<br>`;
            logArea.scrollTop = logArea.scrollHeight;
            console.log(message);
        }
        
        // Função para redirecionar questão baseada no filtro ativo
        function redirecionarQuestao(idQuestao, statusQuestao) {
            try {
                log(`Redirecionando questão: ${idQuestao}, Status: ${statusQuestao}`);
                
                const filtroAtivo = localStorage.getItem('filtro_ativo') || 'todas';
                const urlParams = new URLSearchParams(window.location.search);
                const idAssunto = urlParams.get('id');
                
                log(`Filtro ativo: ${filtroAtivo}`);
                log(`ID Assunto: ${idAssunto}`);
                
                // Se há filtro ativo e não é "todas", vai para quiz sequencial
                if (filtroAtivo !== 'todas') {
                    const url = `quiz_sequencial.php?id=${idAssunto}&filtro=${filtroAtivo}&questao=${idQuestao}`;
                    log(`Redirecionando para quiz sequencial: ${url}`);
                    log(`SIMULANDO REDIRECIONAMENTO (não vai redirecionar de verdade)`);
                    // window.location.href = url; // Comentado para teste
                } else {
                    // Comportamento normal - vai para quiz individual
                    const url = `quiz.php?id=${idQuestao}`;
                    log(`Redirecionando para quiz individual: ${url}`);
                    log(`SIMULANDO REDIRECIONAMENTO (não vai redirecionar de verdade)`);
                    // window.location.href = url; // Comentado para teste
                }
            } catch (error) {
                log(`ERRO ao redirecionar questão: ${error.message}`);
                console.error('Erro ao redirecionar questão:', error);
            }
        }
        
        function setFiltroERedireccionar(idQuestao, filtro) {
            localStorage.setItem('filtro_ativo', filtro);
            log(`Filtro definido como: ${filtro}`);
            redirecionarQuestao(idQuestao, 'nao-respondida');
        }
        
        function limparFiltro() {
            localStorage.removeItem('filtro_ativo');
            log('Filtro removido do localStorage');
        }
        
        function definirFiltro(filtro) {
            localStorage.setItem('filtro_ativo', filtro);
            log(`Filtro definido como: ${filtro}`);
        }
        
        function verificarFiltro() {
            const filtro = localStorage.getItem('filtro_ativo') || 'todas';
            log(`Filtro atual: ${filtro}`);
        }
        
        // Log inicial
        log('Página de teste carregada');
        verificarFiltro();
    </script>
</body>
</html>